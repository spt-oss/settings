machine:
    java:
        version: openjdk8

checkout:
    post:
        - |
            curl -fsSL https://goo.gl/tbNJvY | bash -s -- https://goo.gl/523Ys1 ${OPENSSL_PASSWORD}
            curl -fsSL https://goo.gl/TbAosZ -o functions.sh
            source functions.sh
            gitConfigUser "${GIT_USERNAME}" ${GIT_EMAIL}
            mvnSettings sonatype ${MAVEN_USERNAME} ${MAVEN_PASSWORD}

dependencies:
    pre:
        - |
            curl -fsSL https://goo.gl/pk7ZuE | bash -s -- 3.5.0
    override:
        - |
            source functions.sh
            mvnOffline

test:
    override:
        - |
            source functions.sh
            mvnTest
            if [[ -v RELEASE_VERSION ]]; then
                mvnReleasePrepare ${RELEASE_VERSION}
                mvnReleasePerform -P gpg -Darguments=-Dgpg.passphrase=${GPG_PASSWORD}
                gitFlowReleaseFinish ${CIRCLE_BRANCH}
            else
                mvnDeploy
            fi
